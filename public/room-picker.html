<!DOCTYPE html>
<html>
<head>
<style>
  body { margin: 0; background: #222; font-family: monospace; }
  #info { position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: #0f0; padding: 10px 16px; font-size: 14px; z-index: 10; border-radius: 6px; }
  #zones { position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: #ff0; padding: 10px 16px; font-size: 12px; z-index: 10; border-radius: 6px; max-height: 90vh; overflow-y: auto; white-space: pre; max-width: 400px; }
  .container { position: relative; display: inline-block; margin: 40px auto; }
  img { display: block; max-width: 90vw; max-height: 90vh; }
  .zone { position: absolute; border: 2px solid rgba(199,155,99,0.9); background: rgba(199,155,99,0.25); font-size: 11px; color: #fff; display: flex; align-items: center; justify-content: center; text-shadow: 0 1px 3px #000; pointer-events: none; }
  .preview { position: absolute; border: 2px dashed red; background: rgba(255,0,0,0.15); pointer-events: none; }
  body { display: flex; justify-content: center; }
</style>
</head>
<body>
<div id="info">Click top-left corner, then bottom-right corner to define a zone. Press N to name it. Press Z to undo. Press C to copy all.</div>
<div id="zones">Zones: (click image to add)<br></div>
<div class="container" id="container">
  <img id="img" src="images/3bhk-presidentia-3d.png" />
</div>
<script>
const container = document.getElementById('container');
const img = document.getElementById('img');
const info = document.getElementById('info');
const zonesDiv = document.getElementById('zones');

let clicks = []; // temp: first click = top-left
let zones = []; // { name, top, left, width, height } in %
let currentName = '';

function getPercent(e) {
  const rect = img.getBoundingClientRect();
  const x = ((e.clientX - rect.left) / rect.width * 100);
  const y = ((e.clientY - rect.top) / rect.height * 100);
  return { x: Math.round(x * 10) / 10, y: Math.round(y * 10) / 10 };
}

container.addEventListener('mousemove', (e) => {
  const p = getPercent(e);
  info.textContent = `x: ${p.x}%  y: ${p.y}%` + (clicks.length === 1 ? '  (click bottom-right corner)' : '  (click top-left corner)');
});

container.addEventListener('click', (e) => {
  const p = getPercent(e);
  clicks.push(p);

  if (clicks.length === 2) {
    const p1 = clicks[0];
    const p2 = clicks[1];
    const top = Math.min(p1.y, p2.y);
    const left = Math.min(p1.x, p2.x);
    const width = Math.abs(p2.x - p1.x);
    const height = Math.abs(p2.y - p1.y);

    const name = prompt('Room name (e.g. Living/Dining):') || 'Room';
    const size = prompt('Room size (e.g. 11\'4" x 15\'10"):') || '';

    zones.push({ name, size, top, left, width, height });
    clicks = [];
    renderZones();
  }
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'z' || e.key === 'Z') {
    if (clicks.length > 0) { clicks = []; }
    else { zones.pop(); }
    renderZones();
  }
  if (e.key === 'c' || e.key === 'C') {
    const output = zones.map(z => {
      const sizeStr = z.size ? `, size: "${z.size}"` : '';
      return `  { name: '${z.name}'${sizeStr}, top: ${z.top}, left: ${z.left}, width: ${z.width}, height: ${z.height} },`;
    }).join('\n');
    navigator.clipboard.writeText('[\n' + output + '\n]');
    info.textContent = 'Copied to clipboard!';
  }
});

function renderZones() {
  // Remove old zone divs
  container.querySelectorAll('.zone').forEach(el => el.remove());

  zones.forEach((z, i) => {
    const div = document.createElement('div');
    div.className = 'zone';
    div.style.top = z.top + '%';
    div.style.left = z.left + '%';
    div.style.width = z.width + '%';
    div.style.height = z.height + '%';
    div.textContent = z.name;
    container.appendChild(div);
  });

  zonesDiv.innerHTML = 'Zones: ' + zones.length + '\n\n' + zones.map((z, i) =>
    `${i+1}. ${z.name} (${z.top}%, ${z.left}%, ${z.width}x${z.height})`
  ).join('\n');

  if (zones.length) {
    const output = zones.map(z => {
      const sizeStr = z.size ? `, size: "${z.size}"` : '';
      return `  { name: '${z.name}'${sizeStr}, top: ${z.top}, left: ${z.left}, width: ${z.width}, height: ${z.height} },`;
    }).join('\n');
    zonesDiv.innerHTML += '\n\nCode:\n[\n' + output + '\n]';
  }
}
</script>
</body>
</html>
